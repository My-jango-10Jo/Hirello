<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .kanban-board {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .kanban-column {
            background: #f0f0f0;
            border-radius: 5px;
            padding: 10px;
            width: 300px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            cursor: grab;
        }
        .kanban-column h2 {
            text-align: center;
            color: #333;
        }
        .kanban-cards {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .kanban-card {
            background: #fff;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: grab;
        }
        .add-card-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            align-self: flex-end;
        }
    </style>
</head>
<body>

<div class="kanban-board" id="kanban-board" ondrop="dropColumn(event)" ondragover="allowDrop(event)">
    <div class="kanban-column" id="todo-column" draggable="true" ondragstart="dragColumn(event)">
        <h2>To Do</h2>
        <div class="kanban-cards" id="todo-cards" ondrop="dropCard(event)" ondragover="allowDrop(event)">
            <div class="kanban-card" id="task1" draggable="true" ondragstart="dragCard(event)">Task 1</div>
            <div class="kanban-card" id="task2" draggable="true" ondragstart="dragCard(event)">Task 2</div>
        </div>
        <button class="add-card-btn" onclick="addCard('todo-column')">Add Card</button>
    </div>
    <div class="kanban-column" id="in-progress-column" draggable="true" ondragstart="dragColumn(event)">
        <h2>In Progress</h2>
        <div class="kanban-cards" id="in-progress-cards" ondrop="dropCard(event)" ondragover="allowDrop(event)"></div>
        <button class="add-card-btn" onclick="addCard('in-progress-column')">Add Card</button>
    </div>
    <div class="kanban-column" id="done-column" draggable="true" ondragstart="dragColumn(event)">
        <h2>Done</h2>
        <div class="kanban-cards" id="done-cards" ondrop="dropCard(event)" ondragover="allowDrop(event)"></div>
        <button class="add-card-btn" onclick="addCard('done-column')">Add Card</button>
    </div>
</div>

<script>
    // Drag and Drop Functions for Cards
    function allowDrop(event) {
        event.preventDefault();
    }

    function dragCard(event) {
        event.dataTransfer.setData("text", event.target.id);
    }

    function dropCard(event) {
        event.preventDefault();
        const data = event.dataTransfer.getData("text");
        const card = document.getElementById(data);
        const targetColumn = event.target.closest('.kanban-cards');

        if (targetColumn) {
            targetColumn.appendChild(card);
            saveCardOrder();
        }
    }

    function addCard(columnId) {
        const cardText = prompt('Enter card text:');
        if (cardText) {
            const column = document.getElementById(columnId);
            const newCard = document.createElement('div');
            newCard.className = 'kanban-card';
            newCard.textContent = cardText;
            newCard.setAttribute('draggable', 'true');
            newCard.setAttribute('ondragstart', 'dragCard(event)');
            newCard.id = 'card-' + Date.now();
            column.querySelector('.kanban-cards').appendChild(newCard);
            saveCardOrder();
        }
    }

    // Drag and Drop Functions for Columns
    function dragColumn(event) {
        event.dataTransfer.setData("text", event.target.id);
    }

    function dropColumn(event) {
        event.preventDefault();
        const data = event.dataTransfer.getData("text");
        const column = document.getElementById(data);
        const board = document.getElementById('kanban-board');
        const targetColumn = event.target.closest('.kanban-column');

        if (targetColumn && column !== targetColumn) {
            const progress = Array.from(board.children);
            const targetIndex = progress.indexOf(targetColumn);

            board.insertBefore(column, targetIndex > 0 ? progress[targetIndex + 1] : targetColumn);
            saveColumnOrder();
        }
    }

    // Save Card Order to Backend
    function saveCardOrder() {
        const progress = document.querySelectorAll('.kanban-column');
        const cardOrder = {};

        progress.forEach(column => {
            const cards = Array.from(column.querySelector('.kanban-cards').children);
            cardOrder[column.id] = cards.map(card => card.id);
        });

        fetch('/api/saveCardOrder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ cardOrder }),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Card order saved:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    // Save Column Order to Backend
    function saveColumnOrder() {
        const board = document.getElementById('kanban-board');
        const progress = Array.from(board.children);
        const columnOrder = progress.map(column => column.id);

        fetch('/api/saveColumnOrder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ columnOrder }),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Column order saved:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }
</script>
</body>
</html>
